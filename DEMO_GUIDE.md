#!/bin/bash
# Demo script for Mini OS security features
# Shows usage of user management, file management, and firewall commands

"=== Mini OS Security Features Demo ==="
""

"1. USER MANAGEMENT COMMANDS"
"  whoami          - Show current user"
"  users           - List all users"
"  adduser <name>  - Create new user"
"  su <name>       - Switch to user"
"  deluser <name>  - Delete user (root only)"
"  logout          - Logout current user"
""

"2. FILE MANAGEMENT COMMANDS"
"  pwd             - Print working directory"
"  cd <path>       - Change directory"
"  ls [path]       - List files with metadata"
"  touch <file>    - Create empty file"
"  mkdir <dir>     - Create directory"
"  stat <path>     - Show file statistics"
"  echo <text> > <f> - Write to file"
"  edit <file>     - View file contents"
"  cat <file>      - Display file with paging"
"  write <f> <text> - Write text to file"
"  cp <src> <dst>  - Copy file"
"  rm <path>       - Remove file"
"  mv <old> <new>  - Rename file"
""

"3. FIREWALL COMMANDS"
"  fw list              - Show all rules"
"  fw allow port N      - Allow traffic on port N"
"  fw deny port N       - Block traffic on port N"
"  fw allow ip A.B.C.D  - Allow IP address"
"  fw deny ip A.B.C.D   - Block IP address"
""

"=== EXAMPLE USAGE SCENARIOS ==="
""

"SCENARIO 1: Create New User"
"Command sequence:"
"  > adduser alice"
"  Enter password: ****"
"  > whoami"
"  Current user: root (uid:0)"
"  > su alice"
"  Password: ****"
"  > whoami"
"  Current user: alice (uid:1)"
""

"SCENARIO 2: File Management with Ownership"
"Command sequence:"
"  > touch myfile.txt"
"  Created: myfile.txt"
"  > echo 'Hello World' > greeting.txt"
"  Written to: greeting.txt"
"  > stat greeting.txt"
"  File: greeting.txt"
"    Size: 11 bytes"
"    Owner: uid:1 gid:1"
"    Mode: 644"
"    Type: file"
"  > chmod 755 greeting.txt"
"  > ls"
"  -rwxr-xr-x alice 1:1 11 bytes greeting.txt"
""

"SCENARIO 3: Firewall Configuration"
"Command sequence:"
"  > fw list"
"  Firewall Rules:"
"  0: DENY ANY"
"  > fw allow port 22"
"  Added rule to allow port 22"
"  > fw allow port 80"
"  Added rule to allow port 80"
"  > fw deny port 23"
"  Added rule to deny port 23"
"  > fw list"
"  Firewall Rules:"
"  0: DENY ANY"
"  1: ALLOW PORT 22"
"  2: ALLOW PORT 80"
"  3: DENY PORT 23"
""

"SCENARIO 4: File Encryption"
"Use Case: Protect sensitive documents with XOR encryption"
"Commands:"
"  > echo Hello World > document.txt"
"  (echo) wrote X bytes to document.txt"
"  > edit document.txt"
"  --- File: document.txt ---"
"  Hello World"
"  > encrypt document.txt document.txt.enc mykey123"
"  File encrypted successfully: 11 bytes"
"  > edit document.txt.enc"
"  --- File: document.txt.enc (encrypted content, appears as binary) ---"
"  > decrypt document.txt.enc document.txt.dec mykey123"
"  File decrypted successfully: 11 bytes"
"  > edit document.txt.dec"
"  --- File: document.txt.dec ---"
"  Hello World"
""

"SCENARIO 5: File Compression"
"Use Case: Reduce file size for repetitive data"
"Commands:"
"  > echo AAAAAABBBBBCCCC > data.txt"
"  (echo) wrote X bytes to data.txt"
"  > stat data.txt"
"  --- File Statistics: data.txt ---"
"  Size: 18 bytes"
"  Owner: alice (uid:1)"
"  Mode: 0644"
"  > compress data.txt data.txt.rle"
"  File compressed successfully: 10 bytes"
"  > stat data.txt.rle"
"  --- File Statistics: data.txt.rle ---"
"  Size: 10 bytes"
"  Owner: alice (uid:1)"
"  Mode: 0644"
"  > decompress data.txt.rle data.txt.dec"
"  File decompressed successfully: 18 bytes"
"  > edit data.txt.dec"
"  --- File: data.txt.dec ---"
"  AAAAAABBBBBCCCC"
""

"SCENARIO 6: Security Workflow (Combined)"
"Use Case: Encrypt sensitive data then compress"
"Commands:"
"  > echo Confidential password=secret123 > config.txt"
"  > encrypt config.txt config.txt.enc adminpassword"
"  File encrypted successfully: 32 bytes"
"  > compress config.txt.enc config.txt.enc.rle"
"  File compressed successfully: 18 bytes"
"  > stat config.txt"
"  Size: 32 bytes"
"  > stat config.txt.enc"
"  Size: 32 bytes"
"  > stat config.txt.enc.rle"
"  Size: 18 bytes"
""

"=== SECURITY FEATURES ==="
""
"✓ User Authentication with SHA-256 password hashing"
"✓ User privilege levels (root uid=0)"
"✓ File ownership tracking (uid:gid)"
"✓ File permission bits (POSIX-style)"
"✓ Firewall with default-deny policy"
"✓ Network rule matching (port/IP based)"
"✓ XOR Encryption for file security (educational implementation)"
"✓ RLE Compression for file size reduction"
"✓ Command case-insensitivity with case-preserving arguments"
"✓ Buffer overflow protection"
"✓ Input validation and error handling"
""

"=== REQUIREMENTS ==="
""
"Building:"
"  make pegasus.iso"
""
"Running:"
"  qemu-system-i386 -cdrom pegasus.iso"
""
"Or with more options:"
"  qemu-system-i386 -cdrom pegasus.iso -m 512 -display gtk"
""

"=== NOTES ==="
""
"• Users are stored in memory (max 16 users)"
"• Users can be initialized from /etc/passwd"
"• Firewall rules are stored in memory (max 256 rules)"
"• File operations work with ramfs (packaged + overlay)"
"• Permissions are tracked but enforcement is partial"
"• sudo command is recognized but limited to root users"
""
